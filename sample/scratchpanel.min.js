function ScratchPanel(e){function t(){for(var t in O)e.hasOwnProperty(t)||(e[t]=O[t]);n(),a(),o(),r()}function n(){b=document.getElementById(e.elementId),y=document.createElement("canvas"),k=y.getContext("2d"),e.width=b.clientWidth,e.height=b.clientHeight,y.width=e.width,y.height=e.height,b.appendChild(y)}function a(){if(!e.foreground)return console.error("A foreground image must be specified");var t=document.createElement("img");""!=e.crossOrigin&&(t.crossOrigin=e.crossOrigin),t.src=e.foreground,t.onload=function(){k.drawImage(t,0,0,e.width,e.height),e.background?setTimeout(function(){b.style.background="url('"+e.background+"')",i()},e.backgroundLoadDelay):i()}}function i(){L=!0,e.readyCallback&&e.readyCallback.apply(null)}function o(){y.addEventListener("mousedown",u),y.addEventListener("mousemove",d),y.addEventListener("mouseup",h),y.addEventListener("touchstart",u),y.addEventListener("touchmove",d),y.addEventListener("touchend",h)}function r(){w=c(function(){s(),e.callback&&e.callback.apply(null)})}function c(e){return function(){if(f=e,e=null,null!=f)return f.apply(this,arguments)}}function l(){return e.enabled&&L}function u(t){if(l()){t.preventDefault(),E=!0;var n=g(t);k.globalCompositeOperation="destination-out",k.lineJoin="round",k.lineCap="round",k.strokeStyle="#000000",k.fillStyle="#000000",k.lineWidth=e.scratchSize,k.beginPath(),k.arc(n.x,n.y,e.scratchSize/2,0,2*Math.PI,!0),k.closePath(),k.fill(),k.beginPath(),k.moveTo(n.x,n.y)}}function d(t){if(l()&&(t.preventDefault(),E)){var n=g(t);k.lineTo(n.x,n.y),k.stroke(),C%5===0&&p()>=e.threshold&&w(),C++}}function h(e){l()&&(e.preventDefault(),E=!1,k.closePath())}function s(){k.clearRect(0,0,e.width,e.height)}function g(e){var t=e.target.getBoundingClientRect();return e.clientX?{x:e.clientX-t.left,y:e.clientY-t.top}:e.touches[0]?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:void 0}function p(){for(var t=k.getImageData(0,0,e.width,e.height),n=0,a=0,i=0;i<t.data.length;i+=4)0===t.data[i]&&0===t.data[i+1]&&0===t.data[i+2]&&0===t.data[i+3]&&(a+=1),n+=1;return a/n*100}function v(t,n){e[t]=n}function m(t){return e[t]}var b,y,k,w,E,C=0,L=!1;e=e||{};var O={elementId:"scratch-panel",threshold:65,callback:null,readyCallback:null,foreground:"",background:"",crossOrigin:"",scratchSize:40,enabled:!0,backgroundLoadDelay:300};return t(),{getPercentScratched:p,clear:s,setOption:v,getOption:m}}